name: upsun
repository: https://github.com/ddev/ddev-upsun/tarball/refs/pull/23/head
version: ""
install_date: "2026-02-04T14:53:14+05:30"
project_files:
    - upsun/install-hook.php
    - upsun/UpsunConfigParserInterface.php
    - upsun/UpsunConfigParser.php
    - upsun/FixedConfigDetector.php
    - upsun/FixedConfigParser.php
    - upsun/DdevConfigGenerator.php
    - upsun/PlatformEnvironmentGenerator.php
    - upsun/EnvironmentLoader.php
    - upsun/ServiceDetector.php
    - upsun/debug-parser.php
global_files: []
removal_actions:
    - |
      <?php
      # #ddev-description Remove Upsun-generated files
      echo "=== Upsun add-on removal cleanup ===\n";
      $files_to_remove = [
        'config.upsun.yaml',
        'web-build/Dockerfile.upsun',
        '.env.upsun-services',
        'web-entrypoint.d/environment.sh'
      ];

      foreach ($files_to_remove as $file) {
        if (file_exists($file)) {
          $content = file_get_contents($file);
          $isGenerated = strpos($content, '#ddev-generated') !== false ||
                        strpos($content, '# Upsun service versions (auto-generated') !== false;

          if ($isGenerated) {
            if (unlink($file)) {
              echo "✅ Removed: $file\n";
            } else {
              echo "❌ Failed to remove: $file\n";
            }
          } else {
            echo "⚠️  Skipped: $file (not auto-generated)\n";
          }
        } else {
          echo "ℹ️  Not found: $file\n";
        }
      }

      // Clean up empty web-build directory
      if (is_dir('web-build')) {
        $files = array_diff(scandir('web-build'), ['.', '..']);
        if (empty($files)) {
          if (rmdir('web-build')) {
            echo "✅ Removed empty directory: web-build\n";
          }
        }
      }
      echo "=== Cleanup completed ===\n";
